<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Desembolsos vs Gastos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #ffa366 25%, #ffffff 60%, #fff8f0 85%, #ff6b35 100%);
            min-height: 100vh;
            color: #1a202c;
            overflow-x: hidden;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Month Selector Styles */
        .month-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .month-btn {
            padding: 0.75rem 2rem;
            border: 2px solid rgba(255, 107, 53, 0.3);
            border-radius: 12px;
            background: rgba(255, 107, 53, 0.1);
            color: #64748b;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .month-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: translateY(-2px);
        }

        .month-btn.active {
            background: linear-gradient(135deg, #ff6b35, #ffa366);
            color: white;
            border-color: #ff6b35;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 25px 50px rgba(255, 107, 53, 0.15);
            border: 1px solid rgba(255, 107, 53, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ff6b35, #ffa366, #ff8c42, #ffb366);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b35, #ffa366);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }

        .header-title h1 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ff6b35, #e55a2b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            color: #64748b;
            font-size: 1rem;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .quick-stat {
            text-align: center;
            padding: 0.75rem 1rem;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border-left: 4px solid #ff6b35;
        }

        .quick-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ff6b35;
        }

        .quick-stat-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-btn:hover {
            background: rgba(255, 107, 53, 0.1);
            color: #ff6b35;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff6b35, #ffa366);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .tab-icon {
            font-size: 1.1rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid Layouts */
        .overview-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .kpis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .charts-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(255, 107, 53, 0.2);
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            position: relative;
            transition: all 0.3s ease;
            text-align: center;
        }

        .kpi-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 25px 50px rgba(255, 107, 53, 0.2);
        }

        .kpi-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 1rem;
        }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: #ff6b35;
            margin-bottom: 0.5rem;
        }

        .kpi-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        /* Chart Styles */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1a202c;
        }

        .chart-wrapper {
            position: relative;
            height: 350px;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th {
            background: linear-gradient(135deg, #ff6b35, #ffa366);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background-color: rgba(255, 107, 53, 0.05);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completed {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Summary Box */
        .summary-box {
            background: linear-gradient(135deg, #ff6b35, #ffa366);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .summary-box::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -25%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .summary-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .overview-grid {
                grid-template-columns: 1fr;
            }
            
            .financial-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-stats {
                flex-direction: column;
                gap: 1rem;
            }
            
            .tab-navigation {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: auto;
            }
            
            .kpis-grid {
                grid-template-columns: 1fr;
            }

            .month-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Month Selector -->
        <div class="month-selector">
            <button class="month-btn" data-month="junio">
                <span>📅</span>
                Junio 2025
            </button>
            <button class="month-btn active" data-month="julio">
                <span>📅</span>
                Julio 2025
            </button>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">CF</div>
                    <div>
                        <h1>Desembolso vs lo gastado </h1>
                        <p class="header-subtitle" id="current-month">Julio 2025</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="stat-desembolsado">Q8.2M</div>
                        <div class="quick-stat-label">Desembolsado</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="stat-casos">60</div>
                        <div class="quick-stat-label">Casos</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="stat-inversion">Q302K</div>
                        <div class="quick-stat-label">Inversión Pauta</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="stat-retorno">27.2X</div>
                        <div class="quick-stat-label">Retorno</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="overview">
                <span class="tab-icon">📊</span>
                Resumen General
            </button>
            <button class="tab-btn" data-tab="eficiencia">
                <span class="tab-icon">⚡</span>
                Eficiencia de Pauta
            </button>
            <button class="tab-btn" data-tab="geografico">
                <span class="tab-icon">🗺️</span>
                Análisis Geográfico
            </button>
            <button class="tab-btn" data-tab="clientes">
                <span class="tab-icon">👥</span>
                Análisis de Clientes
            </button>
            <button class="tab-btn" data-tab="detalle">
                <span class="tab-icon">📋</span>
                Reporte Detallado
            </button>
        </div>

        <!-- Tab Contents -->
        
        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <div class="overview-grid">
                <div class="kpis-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">💰</div>
                        <div class="kpi-value" id="kpi-desembolsado">Q8.2M</div>
                        <div class="kpi-label">Total Desembolsado</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #06b6d4, #67e8f9);">🎯</div>
                        <div class="kpi-value" id="kpi-casos">60</div>
                        <div class="kpi-label">Total de Casos</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">🏢</div>
                        <div class="kpi-value" id="kpi-sucursales">6</div>
                        <div class="kpi-label">Sucursales Activas</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">📈</div>
                        <div class="kpi-value" id="kpi-promedio">Q137K</div>
                        <div class="kpi-label">Promedio por Caso</div>
                    </div>
                </div>

                <div class="charts-main">
                    <div class="card">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribución por Sucursal</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="overviewChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="summary-box">
                    <h3 class="summary-title" id="summary-title">📊 Resumen Julio 2025</h3>
                    <div class="summary-item">
                        <span>Casos Nuevos</span>
                        <strong id="summary-nuevos">40 (66.7%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Ampliaciones</span>
                        <strong id="summary-ampliaciones">20 (33.3%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Retorno de Pauta</span>
                        <strong id="summary-retorno">27.2X</strong>
                    </div>
                    <div class="summary-item">
                        <span>Mejor Eficiencia</span>
                        <strong id="summary-mejor">PETÉN (48.8X)</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Eficiencia de Pauta Tab -->
        <div class="tab-content" id="eficiencia">
            <div class="overview-grid">
                <div class="kpis-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">⚡</div>
                        <div class="kpi-value" id="kpi-eficiencia-retorno">27.2X</div>
                        <div class="kpi-label">Retorno por Q1</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #ef4444, #f87171);">💸</div>
                        <div class="kpi-value" id="kpi-eficiencia-inversion">Q302K</div>
                        <div class="kpi-label">Total Inversión Pauta</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">🎯</div>
                        <div class="kpi-value" id="kpi-eficiencia-costo">Q5.0K</div>
                        <div class="kpi-label">Costo por Cliente</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">📈</div>
                        <div class="kpi-value" id="kpi-eficiencia-conversion">18.9%</div>
                        <div class="kpi-label">Tasa de Conversión</div>
                    </div>
                </div>

                <div class="charts-main">
                    <div class="card">
                        <div class="chart-header">
                            <h3 class="chart-title">Desembolsos vs Inversión en Pauta</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="pautaComparativeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="summary-box">
                    <h3 class="summary-title">⚡ Eficiencia Total</h3>
                    <div class="summary-item">
                        <span>Inversión en Pauta</span>
                        <strong id="eficiencia-summary-inversion">Q301,607</strong>
                    </div>
                    <div class="summary-item">
                        <span>Desembolsos Generados</span>
                        <strong id="eficiencia-summary-desembolsos">Q8,200,000</strong>
                    </div>
                    <div class="summary-item">
                        <span>Ganancia Neta</span>
                        <strong id="eficiencia-summary-ganancia">Q7,898,393</strong>
                    </div>
                    <div class="summary-item">
                        <span>Eficiencia</span>
                        <strong id="eficiencia-summary-ratio">Cada Q1 → Q27.19</strong>
                    </div>
                </div>
            </div>

            <div class="financial-grid" style="margin-top: 2rem;">
                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Eficiencia por Sucursal</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="eficienciaSucursalChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Costo por Cliente Generado</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="costoPorClienteChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 2rem;">
                <h3 class="chart-title">⚡ Análisis de Eficiencia por Sucursal</h3>
                <table class="data-table" id="eficiencia-table">
                    <!-- Dynamic content -->
                </table>
            </div>
        </div>

        <!-- Geografico Tab -->
        <div class="tab-content" id="geografico">
            <div class="overview-grid">
                <div class="kpis-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">🌎</div>
                        <div class="kpi-value" id="geo-regiones">6</div>
                        <div class="kpi-label">Regiones Activas</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #ff6b35, #ffa366);">🏆</div>
                        <div class="kpi-value" id="geo-lider">CENTRAL</div>
                        <div class="kpi-label">Región Líder</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">📍</div>
                        <div class="kpi-value" id="geo-eficiencia">PETÉN</div>
                        <div class="kpi-label">Mayor Eficiencia</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #06b6d4, #67e8f9);">🚀</div>
                        <div class="kpi-value" id="geo-potencial">4 CAMINOS</div>
                        <div class="kpi-label">Potencial</div>
                    </div>
                </div>

                <div class="charts-main">
                    <div class="card">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribución Geográfica</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="geograficoChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="summary-box">
                    <h3 class="summary-title">🗺️ Cobertura Nacional</h3>
                    <div class="summary-item">
                        <span>Región Central</span>
                        <strong id="geo-summary-central">Q4.93M (60.1%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Región Norte</span>
                        <strong id="geo-summary-norte">Q1.77M (21.6%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Región Sur</span>
                        <strong id="geo-summary-sur">Q1.31M (16.0%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Región Occidente</span>
                        <strong id="geo-summary-occidente">Q200K (2.4%)</strong>
                    </div>
                </div>
            </div>

            <div class="financial-grid" style="margin-top: 2rem;">
                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Performance por Región</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="performanceRegionChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Penetración de Mercado</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="penetracionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes Tab -->
        <div class="tab-content" id="clientes">
            <div class="overview-grid">
                <div class="kpis-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">👥</div>
                        <div class="kpi-value" id="clientes-unicos">60</div>
                        <div class="kpi-label">Clientes Únicos</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #ff6b35, #ffa366);">📱</div>
                        <div class="kpi-value" id="clientes-social">40</div>
                        <div class="kpi-label">Vía Social Media</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">🏢</div>
                        <div class="kpi-value" id="clientes-presencial">14</div>
                        <div class="kpi-label">Visitas Presenciales</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">💰</div>
                        <div class="kpi-value" id="clientes-ticket">Q137K</div>
                        <div class="kpi-label">Ticket Promedio</div>
                    </div>
                </div>

                <div class="charts-main">
                    <div class="card">
                        <div class="chart-header">
                            <h3 class="chart-title">Canales de Adquisición</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="canalesChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="summary-box">
                    <h3 class="summary-title">👥 Perfil de Clientes</h3>
                    <div class="summary-item">
                        <span>Clientes Nuevos</span>
                        <strong id="clientes-summary-nuevos">40 (66.7%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Ampliaciones</span>
                        <strong id="clientes-summary-ampliaciones">20 (33.3%)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Canal Principal</span>
                        <strong id="clientes-summary-canal">Social Manager</strong>
                    </div>
                    <div class="summary-item">
                        <span>Tasa Conversión</span>
                        <strong id="clientes-summary-conversion">89.5%</strong>
                    </div>
                </div>
            </div>

            <div class="financial-grid" style="margin-top: 2rem;">
                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Distribución de Montos</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="distribucionMontosChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Eficiencia por Canal</h3>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="eficienciaCanalChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detalle Tab -->
        <div class="tab-content" id="detalle">
            <div class="card">
                <div class="chart-header">
                    <h3 class="chart-title" id="detalle-title">📊 Reporte Ejecutivo Completo - Julio 2025</h3>
                </div>
                <table class="data-table" id="detalle-table">
                    <!-- Dynamic content -->
                </table>
            </div>

            <div class="financial-grid" style="margin-top: 2rem;">
                <div class="card">
                    <h3 class="chart-title">📈 Ranking por Performance</h3>
                    <div class="chart-wrapper">
                        <canvas id="rankingChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 class="chart-title">🎯 Métricas Clave</h3>
                    <div style="padding: 1rem 0;">
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Eficiencia Promedio de Pauta</span>
                                <strong id="metricas-eficiencia">27.2X retorno</strong>
                            </div>
                            <div style="background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="metricas-bar-eficiencia" style="width: 95%; height: 100%; background: linear-gradient(90deg, #10b981, #34d399);"></div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Inversión vs Retorno</span>
                                <strong id="metricas-ratio">Q1 → Q27.19</strong>
                            </div>
                            <div style="background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="metricas-bar-ratio" style="width: 90%; height: 100%; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Casos Nuevos vs Ampliaciones</span>
                                <strong id="metricas-casos">67% vs 33%</strong>
                            </div>
                            <div style="background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="metricas-bar-casos" style="width: 67%; height: 100%; background: linear-gradient(90deg, #ff6b35, #ffa366);"></div>
                            </div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Canal Principal (Social Manager)</span>
                                <strong id="metricas-canal">66.7%</strong>
                            </div>
                            <div style="background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="metricas-bar-canal" style="width: 66.7%; height: 100%; background: linear-gradient(90deg, #06b6d4, #67e8f9);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // DATOS MULTI-MES
        // ========================================
        
        const monthlyData = {
            junio: {
                // Datos de ejemplo para junio - REEMPLAZAR con datos reales del Excel
                general: {
                    totalDesembolsado: 6.8, // Millones
                    totalCasos: 45,
                    totalInversionPauta: 245.5, // Miles
                    retornoPromedio: 27.7,
                    promedioPorCaso: 151
                },
                sucursales: {
                    labels: ['CENTRAL', 'PETÉN', 'ESCUINTLA', 'COBÁN', 'MAZATENANGO', '4 CAMINOS'],
                    desembolsos: [3.8, 1.2, 0.9, 0.45, 0.35, 0.1],
                    casos: [22, 5, 8, 6, 3, 1],
                    gastosPauta: [125.5, 25.0, 28.5, 30.0, 26.5, 10.0],
                    roi: [3024, 4800, 3157, 1500, 1320, 1000],
                    costoXCaso: [5704, 5000, 3562, 5000, 8833, 10000]
                },
                tipos: {
                    labels: ['NUEVO', 'AMPLIACION'],
                    casos: [30, 15],
                    montos: [5.2, 1.6]
                },
                clientes: {
                    canales: ['Social Manager', 'Visita Oficina', 'Correo Electrónico', 'Otros'],
                    casos: [28, 12, 3, 2],
                    promedios: [145, 160, 120, 95]
                }
            },
            julio: {
                // Datos originales de julio
                general: {
                    totalDesembolsado: 8.2,
                    totalCasos: 60,
                    totalInversionPauta: 302,
                    retornoPromedio: 27.2,
                    promedioPorCaso: 137
                },
                sucursales: {
                    labels: ['CENTRAL', 'PETÉN', 'ESCUINTLA', 'COBÁN', 'MAZATENANGO', '4 CAMINOS'],
                    desembolsos: [4.93, 1.38, 0.97, 0.39, 0.335, 0.20],
                    casos: [28, 6, 10, 7, 4, 2],
                    gastosPauta: [157.289, 28.280, 30.335, 31.448, 28.169, 26.086],
                    roi: [3135, 4882, 3197, 1240, 1189, 767],
                    costoXCaso: [5617, 4713, 3034, 4493, 7042, 13043]
                },
                tipos: {
                    labels: ['NUEVO', 'AMPLIACION'],
                    casos: [40, 20],
                    montos: [6.5, 1.7]
                },
                clientes: {
                    canales: ['Social Manager', 'Visita Oficina', 'Correo Electrónico', 'Otros'],
                    casos: [40, 14, 4, 2],
                    promedios: [142, 155, 125, 100]
                }
            }
        };

        // Variables globales
        let currentMonth = 'julio';
        let chartInstances = {};

        // ========================================
        // CONFIGURACIÓN DE CHARTS
        // ========================================
        
        const brandColors = {
            primary: '#ff6b35',
            secondary: '#ffa366',
            accent: '#ff8c42',
            success: '#10b981',
            warning: '#f59e0b',
            error: '#ef4444',
            info: '#06b6d4'
        };

        // ========================================
        // FUNCIONES DE ACTUALIZACIÓN DE UI
        // ========================================
        
        function updateHeaderStats(month) {
            const data = monthlyData[month];
            document.getElementById('current-month').textContent = 
                month === 'julio' ? 'Julio 2025' : 'Junio 2025';
            document.getElementById('stat-desembolsado').textContent = `Q${data.general.totalDesembolsado}M`;
            document.getElementById('stat-casos').textContent = data.general.totalCasos;
            document.getElementById('stat-inversion').textContent = `Q${data.general.totalInversionPauta}K`;
            document.getElementById('stat-retorno').textContent = `${data.general.retornoPromedio}X`;
        }

        function updateKPIs(month) {
            const data = monthlyData[month];
            document.getElementById('kpi-desembolsado').textContent = `Q${data.general.totalDesembolsado}M`;
            document.getElementById('kpi-casos').textContent = data.general.totalCasos;
            document.getElementById('kpi-sucursales').textContent = data.sucursales.labels.length;
            document.getElementById('kpi-promedio').textContent = `Q${data.general.promedioPorCaso}K`;
        }

        function updateSummaryBoxes(month) {
            const data = monthlyData[month];
            const monthName = month === 'julio' ? 'Julio' : 'Junio';
            
            document.getElementById('summary-title').textContent = `📊 Resumen ${monthName} 2025`;
            
            const nuevosPercent = ((data.tipos.casos[0] / data.general.totalCasos) * 100).toFixed(1);
            const ampliacionesPercent = ((data.tipos.casos[1] / data.general.totalCasos) * 100).toFixed(1);
            
            document.getElementById('summary-nuevos').textContent = `${data.tipos.casos[0]} (${nuevosPercent}%)`;
            document.getElementById('summary-ampliaciones').textContent = `${data.tipos.casos[1]} (${ampliacionesPercent}%)`;
            document.getElementById('summary-retorno').textContent = `${data.general.retornoPromedio}X`;
            
            // Encontrar la sucursal con mejor ROI
            const maxROIIndex = data.sucursales.roi.indexOf(Math.max(...data.sucursales.roi));
            const mejorSucursal = data.sucursales.labels[maxROIIndex];
            const mejorROI = (data.sucursales.roi[maxROIIndex] / 100).toFixed(1);
            document.getElementById('summary-mejor').textContent = `${mejorSucursal} (${mejorROI}X)`;
        }

        function updateGeograficoKPIs(month) {
            const data = monthlyData[month];
            
            // Encontrar región líder (mayor desembolso)
            const maxDesembolsoIndex = data.sucursales.desembolsos.indexOf(Math.max(...data.sucursales.desembolsos));
            const regionLider = data.sucursales.labels[maxDesembolsoIndex];
            
            // Encontrar región con mayor eficiencia
            const maxROIIndex = data.sucursales.roi.indexOf(Math.max(...data.sucursales.roi));
            const regionEficiente = data.sucursales.labels[maxROIIndex];
            
            // Región con mayor potencial (menor cantidad de casos pero buena población)
            const regionPotencial = data.sucursales.labels[data.sucursales.labels.length - 1]; // Última sucursal
            
            document.getElementById('geo-regiones').textContent = data.sucursales.labels.length;
            document.getElementById('geo-lider').textContent = regionLider;
            document.getElementById('geo-eficiencia').textContent = regionEficiente;
            document.getElementById('geo-potencial').textContent = regionPotencial;
            
            // Actualizar resumen geográfico
            const totalDesembolso = data.sucursales.desembolsos.reduce((a, b) => a + b, 0);
            const centralPercent = ((data.sucursales.desembolsos[0] / totalDesembolso) * 100).toFixed(1);
            const nortePercent = ((data.sucursales.desembolsos[1] / totalDesembolso) * 100).toFixed(1);
            const surPercent = ((data.sucursales.desembolsos[2] / totalDesembolso) * 100).toFixed(1);
            const occidentePercent = ((data.sucursales.desembolsos[5] / totalDesembolso) * 100).toFixed(1);
            
            document.getElementById('geo-summary-central').textContent = `Q${data.sucursales.desembolsos[0]}M (${centralPercent}%)`;
            document.getElementById('geo-summary-norte').textContent = `Q${data.sucursales.desembolsos[1]}M (${nortePercent}%)`;
            document.getElementById('geo-summary-sur').textContent = `Q${data.sucursales.desembolsos[2]}M (${surPercent}%)`;
            document.getElementById('geo-summary-occidente').textContent = `Q${(data.sucursales.desembolsos[5] * 1000).toFixed(0)}K (${occidentePercent}%)`;
        }

        function updateClientesKPIs(month) {
            const data = monthlyData[month];
            
            const totalClientes = data.clientes.casos.reduce((a, b) => a + b, 0);
            const socialMediaClientes = data.clientes.casos[0];
            const presencialClientes = data.clientes.casos[1];
            
            // Calcular ticket promedio general
            const ticketPromedio = (data.general.totalDesembolsado * 1000000 / totalClientes / 1000).toFixed(0);
            
            document.getElementById('clientes-unicos').textContent = totalClientes;
            document.getElementById('clientes-social').textContent = socialMediaClientes;
            document.getElementById('clientes-presencial').textContent = presencialClientes;
            document.getElementById('clientes-ticket').textContent = `Q${ticketPromedio}K`;
            
            // Actualizar resumen de clientes
            const nuevosPercent = ((data.tipos.casos[0] / totalClientes) * 100).toFixed(1);
            const ampliacionesPercent = ((data.tipos.casos[1] / totalClientes) * 100).toFixed(1);
            const socialPercent = ((socialMediaClientes / totalClientes) * 100).toFixed(1);
            
            document.getElementById('clientes-summary-nuevos').textContent = `${data.tipos.casos[0]} (${nuevosPercent}%)`;
            document.getElementById('clientes-summary-ampliaciones').textContent = `${data.tipos.casos[1]} (${ampliacionesPercent}%)`;
            document.getElementById('clientes-summary-canal').textContent = data.clientes.canales[0];
            document.getElementById('clientes-summary-conversion').textContent = `${socialPercent}%`;
        }

        function updateMetricasDetalle(month) {
            const data = monthlyData[month];
            
            // Actualizar métricas clave en la pestaña de detalle
            document.getElementById('metricas-eficiencia').textContent = `${data.general.retornoPromedio}X retorno`;
            
            const ratio = data.general.retornoPromedio;
            document.getElementById('metricas-ratio').textContent = `Q1 → Q${ratio}`;
            
            const nuevosPercent = ((data.tipos.casos[0] / data.general.totalCasos) * 100).toFixed(0);
            const ampliacionesPercent = ((data.tipos.casos[1] / data.general.totalCasos) * 100).toFixed(0);
            document.getElementById('metricas-casos').textContent = `${nuevosPercent}% vs ${ampliacionesPercent}%`;
            
            const socialPercent = ((data.clientes.casos[0] / data.general.totalCasos) * 100).toFixed(1);
            document.getElementById('metricas-canal').textContent = `${socialPercent}%`;
            
            // Actualizar barras de progreso
            const eficienciaBar = Math.min(95, (ratio / 30) * 100); // Normalizar para mostrar
            document.getElementById('metricas-bar-eficiencia').style.width = `${eficienciaBar}%`;
            
            const ratioBar = Math.min(90, (ratio / 35) * 100);
            document.getElementById('metricas-bar-ratio').style.width = `${ratioBar}%`;
            
            document.getElementById('metricas-bar-casos').style.width = `${nuevosPercent}%`;
            document.getElementById('metricas-bar-canal').style.width = `${socialPercent}%`;
        }

        function updateEficienciaKPIs(month) {
            const data = monthlyData[month];
            document.getElementById('kpi-eficiencia-retorno').textContent = `${data.general.retornoPromedio}X`;
            document.getElementById('kpi-eficiencia-inversion').textContent = `Q${data.general.totalInversionPauta}K`;
            
            const costoPromedio = data.general.totalInversionPauta * 1000 / data.general.totalCasos;
            document.getElementById('kpi-eficiencia-costo').textContent = `Q${(costoPromedio/1000).toFixed(1)}K`;
            
            // Tasa de conversión aproximada
            document.getElementById('kpi-eficiencia-conversion').textContent = '18.9%';
            
            // Actualizar summary box de eficiencia
            const totalInversion = data.general.totalInversionPauta * 1000;
            const totalDesembolsos = data.general.totalDesembolsado * 1000000;
            const ganancia = totalDesembolsos - totalInversion;
            const ratio = totalDesembolsos / totalInversion;
            
            document.getElementById('eficiencia-summary-inversion').textContent = `Q${totalInversion.toLocaleString()}`;
            document.getElementById('eficiencia-summary-desembolsos').textContent = `Q${totalDesembolsos.toLocaleString()}`;
            document.getElementById('eficiencia-summary-ganancia').textContent = `Q${ganancia.toLocaleString()}`;
            document.getElementById('eficiencia-summary-ratio').textContent = `Cada Q1 → Q${ratio.toFixed(2)}`;
        }

        function updateTablesContent(month) {
            const data = monthlyData[month];
            
            // Tabla de eficiencia
            const eficienciaTable = document.getElementById('eficiencia-table');
            let eficienciaHTML = `
                <thead>
                    <tr>
                        <th>Sucursal</th>
                        <th>Inversión Pauta</th>
                        <th>Desembolsos</th>
                        <th>Retorno por Q1</th>
                        <th>Costo/Cliente</th>
                        <th>Casos</th>
                        <th>Eficiencia</th>
                        <th>Calificación</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            data.sucursales.labels.forEach((sucursal, i) => {
                const retorno = (data.sucursales.roi[i] / 100).toFixed(2);
                const eficiencia = data.sucursales.roi[i];
                let calificacion = 'En Desarrollo';
                let badgeClass = 'status-completed';
                
                if (eficiencia > 3000) {
                    calificacion = 'Excelente';
                    badgeClass = 'status-active';
                } else if (eficiencia > 1500) {
                    calificacion = 'Muy Buena';
                    badgeClass = 'status-active';
                } else if (eficiencia > 1000) {
                    calificacion = 'Buena';
                    badgeClass = 'status-pending';
                }
                
                eficienciaHTML += `
                    <tr>
                        <td><strong>${sucursal}</strong></td>
                        <td>Q${data.sucursales.gastosPauta[i].toLocaleString()}</td>
                        <td>Q${(data.sucursales.desembolsos[i] * 1000000).toLocaleString()}</td>
                        <td>Q${retorno}</td>
                        <td>Q${data.sucursales.costoXCaso[i].toLocaleString()}</td>
                        <td>${data.sucursales.casos[i]}</td>
                        <td>${(eficiencia/100).toFixed(0)}%</td>
                        <td><span class="status-badge ${badgeClass}">${calificacion}</span></td>
                    </tr>
                `;
            });
            
            eficienciaHTML += '</tbody>';
            eficienciaTable.innerHTML = eficienciaHTML;
            
            // Tabla de detalle
            const detalleTable = document.getElementById('detalle-table');
            let detalleHTML = `
                <thead>
                    <tr>
                        <th>Sucursal</th>
                        <th>Casos</th>
                        <th>Desembolsos</th>
                        <th>Inversión Pauta</th>
                        <th>Retorno</th>
                        <th>Costo/Cliente</th>
                        <th>Ticket Prom.</th>
                        <th>Performance</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            data.sucursales.labels.forEach((sucursal, i) => {
                const retorno = (data.sucursales.roi[i] / 100).toFixed(1);
                const ticketProm = (data.sucursales.desembolsos[i] * 1000000 / data.sucursales.casos[i]).toFixed(0);
                
                let performance = 'Nuevo';
                let badgeClass = 'status-completed';
                
                if (i === 0) {
                    performance = 'Líder';
                    badgeClass = 'status-active';
                } else if (data.sucursales.roi[i] > 4000) {
                    performance = 'Estrella';
                    badgeClass = 'status-active';
                } else if (data.sucursales.roi[i] > 3000) {
                    performance = 'Eficiente';
                    badgeClass = 'status-active';
                } else if (data.sucursales.roi[i] > 1200) {
                    performance = 'Crecimiento';
                    badgeClass = 'status-pending';
                }
                
                detalleHTML += `
                    <tr>
                        <td><strong>${sucursal}</strong></td>
                        <td>${data.sucursales.casos[i]}</td>
                        <td>Q${(data.sucursales.desembolsos[i] * 1000000).toLocaleString()}</td>
                        <td>Q${data.sucursales.gastosPauta[i].toLocaleString()}</td>
                        <td>${retorno}X</td>
                        <td>Q${data.sucursales.costoXCaso[i].toLocaleString()}</td>
                        <td>Q${parseInt(ticketProm).toLocaleString()}</td>
                        <td><span class="status-badge ${badgeClass}">${performance}</span></td>
                    </tr>
                `;
            });
            
            detalleHTML += '</tbody>';
            detalleTable.innerHTML = detalleHTML;
            
            // Actualizar título de detalle
            const monthName = month === 'julio' ? 'Julio' : 'Junio';
            document.getElementById('detalle-title').textContent = `📊 Reporte Ejecutivo Completo - ${monthName} 2025`;
        }

        // ========================================
        // FUNCIONES DE CHARTS
        // ========================================
        
        function destroyChart(chartId) {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                delete chartInstances[chartId];
            }
        }

        function createOverviewChart(month) {
            destroyChart('overview');
            const ctx = document.getElementById('overviewChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['overview'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        data: data.sucursales.desembolsos,
                        backgroundColor: [
                            '#ff6b35', '#ffa366', '#ff8c42', 
                            '#ffb366', '#ff9f59', '#ffcc99'
                        ],
                        borderWidth: 4,
                        borderColor: '#fff',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                padding: 15, 
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: Q${context.parsed}M (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createPautaComparativeChart(month) {
            destroyChart('pautaComparative');
            const ctx = document.getElementById('pautaComparativeChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['pautaComparative'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Desembolsos (Millones Q)',
                        data: data.sucursales.desembolsos,
                        backgroundColor: brandColors.success + '80',
                        borderColor: brandColors.success,
                        borderWidth: 2,
                        borderRadius: 8,
                        yAxisID: 'y'
                    }, {
                        label: 'Gastos Pauta (Miles Q)',
                        data: data.sucursales.gastosPauta.map(g => g/1000),
                        backgroundColor: brandColors.error + '80',
                        borderColor: brandColors.error,
                        borderWidth: 2,
                        borderRadius: 8,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Desembolsos (Millones Q)' },
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value + 'M';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Gastos Pauta (Miles Q)' },
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createEficienciaSucursalChart(month) {
            destroyChart('eficienciaSucursal');
            const ctx = document.getElementById('eficienciaSucursalChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['eficienciaSucursal'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Retorno por Q1',
                        data: data.sucursales.roi.map(roi => roi/100),
                        backgroundColor: data.sucursales.roi.map(roi => {
                            if (roi > 3000) return brandColors.success + '80';
                            if (roi > 1500) return brandColors.warning + '80';
                            return brandColors.info + '80';
                        }),
                        borderColor: data.sucursales.roi.map(roi => {
                            if (roi > 3000) return brandColors.success;
                            if (roi > 1500) return brandColors.warning;
                            return brandColors.info;
                        }),
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Retorno: Q${context.parsed.y.toFixed(2)} por cada Q1 invertido`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Retorno por Q1' },
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value.toFixed(1);
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCostoPorClienteChart(month) {
            destroyChart('costoPorCliente');
            const ctx = document.getElementById('costoPorClienteChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['costoPorCliente'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Costo por Cliente (Q)',
                        data: data.sucursales.costoXCaso,
                        borderColor: brandColors.primary,
                        backgroundColor: brandColors.primary + '20',
                        borderWidth: 4,
                        pointRadius: 8,
                        pointBackgroundColor: brandColors.primary,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Costo por cliente: Q${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Costo por Cliente (Q)' },
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function createGeograficoChart(month) {
            destroyChart('geografico');
            const ctx = document.getElementById('geograficoChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['geografico'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        data: data.sucursales.desembolsos,
                        backgroundColor: [
                            '#ff6b35', '#ffa366', '#ff8c42', 
                            '#ffb366', '#ff9f59', '#ffcc99'
                        ],
                        borderWidth: 4,
                        borderColor: '#fff',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15, font: { size: 10 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: Q${context.parsed}M (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCanalesChart(month) {
            destroyChart('canales');
            const ctx = document.getElementById('canalesChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['canales'] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.clientes.canales,
                    datasets: [{
                        data: data.clientes.casos,
                        backgroundColor: [
                            brandColors.primary, brandColors.info, 
                            brandColors.success, brandColors.accent
                        ],
                        borderWidth: 4,
                        borderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} clientes (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createRankingChart(month) {
            destroyChart('ranking');
            const ctx = document.getElementById('rankingChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['ranking'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Montos (M)',
                        data: data.sucursales.desembolsos,
                        backgroundColor: brandColors.primary + '80',
                        borderColor: brandColors.primary,
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gráficas adicionales para Análisis Geográfico
        function createPerformanceRegionChart(month) {
            destroyChart('performanceRegion');
            const ctx = document.getElementById('performanceRegionChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            const poblacion = [2500, 700, 800, 300, 400, 500]; // en miles
            const penetracion = data.sucursales.casos.map((casos, i) => (casos / poblacion[i]) * 1000); // en promil
            
            chartInstances['performanceRegion'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Casos',
                        data: data.sucursales.casos,
                        backgroundColor: brandColors.info + '80',
                        borderColor: brandColors.info,
                        borderWidth: 2,
                        borderRadius: 8,
                        yAxisID: 'y'
                    }, {
                        label: 'Penetración (‰)',
                        data: penetracion,
                        type: 'line',
                        borderColor: brandColors.warning,
                        backgroundColor: brandColors.warning,
                        borderWidth: 3,
                        pointRadius: 6,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Casos' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Penetración (‰)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        function createPenetracionChart(month) {
            destroyChart('penetracion');
            const ctx = document.getElementById('penetracionChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            const poblacion = [2500, 700, 800, 300, 400, 500]; // en miles
            const oportunidad = poblacion.map((p, i) => (p / data.sucursales.casos[i]) * 0.1); // Factor de oportunidad
            
            chartInstances['penetracion'] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.sucursales.labels,
                    datasets: [{
                        label: 'Oportunidad de Mercado',
                        data: oportunidad,
                        borderColor: brandColors.primary,
                        backgroundColor: brandColors.primary + '20',
                        borderWidth: 3,
                        pointRadius: 5,
                        pointBackgroundColor: brandColors.primary
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { display: false }
                        }
                    }
                }
            });
        }

        // Gráficas adicionales para Análisis de Clientes
        function createDistribucionMontosChart(month) {
            destroyChart('distribucionMontos');
            const ctx = document.getElementById('distribucionMontosChart');
            if (!ctx) return;
            
            // Datos de ejemplo para distribución de montos
            const rangos = {
                'Q30K-Q100K': month === 'julio' ? 28 : 22,
                'Q100K-Q200K': month === 'julio' ? 20 : 15,
                'Q200K-Q400K': month === 'julio' ? 9 : 6,
                'Q400K+': month === 'julio' ? 3 : 2
            };
            
            chartInstances['distribucionMontos'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(rangos),
                    datasets: [{
                        label: 'Clientes por Rango',
                        data: Object.values(rangos),
                        backgroundColor: [
                            brandColors.info + '80',
                            brandColors.success + '80',
                            brandColors.warning + '80',
                            brandColors.primary + '80'
                        ],
                        borderColor: [
                            brandColors.info,
                            brandColors.success,
                            brandColors.warning,
                            brandColors.primary
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = Object.values(rangos).reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed.y / total) * 100).toFixed(1);
                                    return `${context.parsed.y} clientes (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Número de Clientes' }
                        }
                    }
                }
            });
        }

        function createEficienciaCanalChart(month) {
            destroyChart('eficienciaCanal');
            const ctx = document.getElementById('eficienciaCanalChart');
            if (!ctx) return;
            
            const data = monthlyData[month];
            chartInstances['eficienciaCanal'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.clientes.canales,
                    datasets: [{
                        label: 'Ticket Promedio (Miles Q)',
                        data: data.clientes.promedios,
                        borderColor: brandColors.success,
                        backgroundColor: brandColors.success + '20',
                        borderWidth: 4,
                        pointRadius: 8,
                        pointBackgroundColor: brandColors.success,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Ticket Promedio (Miles Q)' },
                            ticks: {
                                callback: function(value) {
                                    return 'Q' + value + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        // ========================================
        // FUNCIÓN PRINCIPAL DE CAMBIO DE MES
        // ========================================
        
        function changeMonth(month) {
            currentMonth = month;
            
            // Actualizar UI
            updateHeaderStats(month);
            updateKPIs(month);
            updateSummaryBoxes(month);
            updateEficienciaKPIs(month);
            updateTablesContent(month);
            
            // Actualizar botones
            document.querySelectorAll('.month-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.month === month);
            });
            
            // Recrear gráficos basados en la pestaña activa
            const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
            initializeChartsForTab(activeTab);
        }

        function initializeChartsForTab(tab) {
            setTimeout(() => {
                try {
                    switch(tab) {
                        case 'overview':
                            createOverviewChart(currentMonth);
                            break;
                        case 'eficiencia':
                            createPautaComparativeChart(currentMonth);
                            createEficienciaSucursalChart(currentMonth);
                            createCostoPorClienteChart(currentMonth);
                            break;
                        case 'geografico':
                            createGeograficoChart(currentMonth);
                            createPerformanceRegionChart(currentMonth);
                            createPenetracionChart(currentMonth);
                            break;
                        case 'clientes':
                            createCanalesChart(currentMonth);
                            createDistribucionMontosChart(currentMonth);
                            createEficienciaCanalChart(currentMonth);
                            break;
                        case 'detalle':
                            createRankingChart(currentMonth);
                            break;
                    }
                } catch (error) {
                    console.log('Error in chart initialization:', error);
                }
            }, 300);
        }

        // ========================================
        // EVENT LISTENERS
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Month selector
            document.querySelectorAll('.month-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const month = this.dataset.month;
                    changeMonth(month);
                });
            });

            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    // Update tab buttons
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetTab).classList.add('active');
                    
                    // Initialize charts for the active tab
                    initializeChartsForTab(targetTab);
                });
            });

            // Initialize with current month data
            changeMonth(currentMonth);
            
            // Add entrance animations
            const cards = document.querySelectorAll('.card, .kpi-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
